name: NetBSD

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      matrix:
        netbsd-version: ['10.0', '9.4', '9.3', '9.2']

    steps:
      - run: curl -LO https://curl.se/ca/cacert.pem
      - run: curl -LO https://raw.githubusercontent.com/leleliu008/ppkg/master/ppkg
      - run: chmod a+x ppkg

      - uses: cross-platform-actions/action@master
        with:
          operating_system: netbsd
          version: ${{ matrix.netbsd-version }}
          shell: bash
          run: |
            set -ex

            #sudo pkgin -y update
            #sudo pkgin -y install curl bsdtar

            sed -i 's|pkgin -y install bash|pkgin -y install bash jq patch patchelf pkg-config|' ppkg

            export SSL_CERT_FILE="$PWD/cacert.pem"

            ls

            ./ppkg setup --syspm
            ./ppkg update
            ./ppkg search lib
